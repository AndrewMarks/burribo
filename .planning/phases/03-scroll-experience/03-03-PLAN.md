---
phase: 03-scroll-experience
plan: 03
type: execute
depends_on: ["03-02"]
files_modified: [assets/js/main.js, assets/css/main.scss, index.md]
---

<objective>
Implement section transitions, card animations, and navigation scroll behavior to complete the scroll experience.

Purpose: Polish the overall scroll journey with section fade-ins, smooth navigation, and active state highlighting - completing the CORE VALUE of the portfolio.
Output: Fully animated scroll experience with section transitions and working navigation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
@./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-scroll-experience/03-RESEARCH.md
@.planning/phases/03-scroll-experience/03-02-SUMMARY.md

**Relevant source files:**
@index.md
@assets/js/main.js
@assets/css/main.scss
@_includes/header.html

**From RESEARCH.md - Batch Animation Pattern:**
```javascript
ScrollTrigger.batch(".card", {
  onEnter: (elements) => {
    gsap.from(elements, {
      opacity: 0,
      y: 50,
      stagger: 0.15,
      duration: 0.6
    });
  },
  start: "top 85%"
});
```

**From RESEARCH.md - Pitfalls:**
- Call ScrollTrigger.refresh() after DOM changes
- Memory leaks - store references for cleanup
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add section and card fade-in animations</name>
  <files>assets/js/main.js, assets/css/main.scss, index.md</files>
  <action>
1. In `index.md`, add animation class to section content:
   - Add class `reveal-section` to `.section-inner` containers
   - Ensure `.card` elements have class for batch animation

2. In `assets/css/main.scss`, add initial states:
   ```scss
   // Section content initial state (set by JS)
   .reveal-section {
     // Will be set to opacity:0, y:40 by JS
   }

   .card {
     // Will be animated by ScrollTrigger.batch
   }
   ```

3. In `assets/js/main.js`, add section transitions:

   a) Section content fade-in:
   ```javascript
   // Set initial state
   gsap.set(".reveal-section", { opacity: 0, y: 40 });

   // Animate on scroll
   document.querySelectorAll('.reveal-section').forEach(section => {
     gsap.to(section, {
       opacity: 1,
       y: 0,
       duration: 0.8,
       ease: "power2.out",
       scrollTrigger: {
         trigger: section,
         start: "top 85%",
         toggleActions: "play none none none"  // Don't reverse
       }
     });
   });
   ```

   b) Card batch animation (staggered reveal):
   ```javascript
   // Set initial state for cards
   gsap.set(".card", { opacity: 0, y: 30 });

   ScrollTrigger.batch(".card", {
     onEnter: batch => {
       gsap.to(batch, {
         opacity: 1,
         y: 0,
         stagger: 0.15,
         duration: 0.6,
         ease: "power2.out"
       });
     },
     start: "top 90%",
     once: true  // Only animate once
   });
   ```

AVOID: Setting initial states in CSS (causes flash of hidden content before JS runs). Set with gsap.set() instead.
  </action>
  <verify>Scroll through page - section content should fade in as it enters viewport. Cards should stagger-reveal together.</verify>
  <done>Sections and cards animate smoothly into view on scroll.</done>
</task>

<task type="auto">
  <name>Task 2: Implement navigation smooth scroll and active states</name>
  <files>assets/js/main.js, assets/css/main.scss</files>
  <action>
1. In `assets/css/main.scss`, add active navigation state:
   ```scss
   .nav-link {
     // existing styles...

     &.is-active {
       color: var(--color-accent);

       // Or subtle underline
       &::after {
         content: '';
         position: absolute;
         bottom: -2px;
         left: 0;
         width: 100%;
         height: 2px;
         background: var(--color-accent);
       }
     }
   }
   ```

2. In `assets/js/main.js`, add navigation behavior:

   a) Smooth scroll for nav links (Lenis handles this, but ensure anchor links work):
   ```javascript
   // Lenis automatically handles anchor scrolling
   // But we can customize the scroll to account for header height
   document.querySelectorAll('a[href^="#"]').forEach(link => {
     link.addEventListener('click', (e) => {
       e.preventDefault();
       const targetId = link.getAttribute('href');
       const target = document.querySelector(targetId);
       if (target) {
         // Lenis scrollTo with offset for fixed header
         lenis.scrollTo(target, {
           offset: -80  // Account for header height
         });
       }
     });
   });
   ```

   b) Active nav state based on scroll position:
   ```javascript
   // Create ScrollTriggers for each section to update active nav
   const sections = ['hero', 'work', 'about', 'contact'];

   sections.forEach(sectionId => {
     ScrollTrigger.create({
       trigger: `#${sectionId}`,
       start: "top center",
       end: "bottom center",
       onEnter: () => setActiveNav(sectionId),
       onEnterBack: () => setActiveNav(sectionId)
     });
   });

   function setActiveNav(activeId) {
     document.querySelectorAll('.nav-link').forEach(link => {
       link.classList.remove('is-active');
       if (link.getAttribute('href') === `#${activeId}`) {
         link.classList.add('is-active');
       }
     });
   }
   ```

AVOID: Using scroll event listeners for active state - use ScrollTrigger callbacks instead.
  </action>
  <verify>
1. Click nav links - page should smooth scroll to section with offset
2. Scroll through page - active nav link should update based on current section
3. No jank when scrolling
  </verify>
  <done>Navigation smooth-scrolls to sections and highlights current section.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete scroll experience with header transforms, text reveals, section transitions, and navigation</what-built>
  <how-to-verify>
    1. Run: `cd "Portfolio Site" && bundle exec jekyll serve`
    2. Visit: http://localhost:4000/burribo/
    3. On page load:
       - Hero "Andrew Marks" text should reveal line-by-line
       - Tagline should fade in after
    4. Scroll down slowly:
       - Header should shrink and get dark background
       - "Work" heading should reveal when entering viewport
       - Cards should stagger-fade in
       - "About" and "Contact" headings should reveal
       - Nav links should highlight based on current section
    5. Click nav links:
       - Should smooth-scroll to section
       - Header offset should be accounted for (content not hidden)
    6. Scroll back to top:
       - Header should return to transparent/large state
       - Hero should still be visible (no re-animation)
    7. Check mobile (resize to narrow):
       - Animations should still work
       - No horizontal scroll introduced
       - Scroll still smooth
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Section content fades in on scroll
- [ ] Cards stagger-animate when entering viewport
- [ ] Nav links smooth-scroll to sections
- [ ] Active nav state updates based on scroll position
- [ ] Header offset accounted for when scrolling to sections
- [ ] All animations feel smooth and intentional
- [ ] Mobile experience works without issues
- [ ] Human verification checkpoint passed
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verification approved
- Phase 3: Scroll Experience complete
- CORE VALUE delivered: scroll feels polished and intentional
</success_criteria>

<output>
After completion, create `.planning/phases/03-scroll-experience/03-03-SUMMARY.md` with:
- Summary of complete scroll experience implementation
- Note that Phase 3 is complete
</output>
