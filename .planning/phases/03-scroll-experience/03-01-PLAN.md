---
phase: 03-scroll-experience
plan: 01
type: execute
depends_on: []
files_modified: [_layouts/default.html, assets/js/main.js, assets/css/main.scss]
---

<objective>
Set up GSAP animation foundation and implement sticky header with scroll-based transforms.

Purpose: Establish the animation infrastructure (GSAP + Lenis) that all Phase 3 animations depend on, then implement the persistent header that shrinks and gains background on scroll.
Output: Working animation stack with smooth scroll and header that transforms on scroll.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-scroll-experience/03-RESEARCH.md

**Relevant source files:**
@_layouts/default.html
@_includes/header.html
@assets/css/main.scss

**From RESEARCH.md - Standard Stack:**
- GSAP 3.12+ via CDN (now 100% free)
- ScrollTrigger (bundled with GSAP)
- Lenis for smooth scroll

**From RESEARCH.md - Don't Hand-Roll:**
- Text splitting → use SplitText
- Scroll position tracking → use ScrollTrigger
- Smooth scroll physics → use Lenis

**From RESEARCH.md - Key Patterns:**
- Register plugins before creating animations
- Sync Lenis with GSAP ticker
- Only animate transform/opacity (compositor thread)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add GSAP/Lenis scripts and create main.js</name>
  <files>_layouts/default.html, assets/js/main.js</files>
  <action>
1. In `_layouts/default.html`, replace the script placeholder with CDN links:
   - GSAP core: https://cdn.jsdelivr.net/npm/gsap@3.12/dist/gsap.min.js
   - ScrollTrigger: https://cdn.jsdelivr.net/npm/gsap@3.12/dist/ScrollTrigger.min.js
   - SplitText: https://cdn.jsdelivr.net/npm/gsap@3.12/dist/SplitText.min.js
   - Lenis: https://cdn.jsdelivr.net/npm/lenis@1/dist/lenis.min.js
   - Then link to `/assets/js/main.js`

2. Create `assets/js/main.js` with:
   - gsap.registerPlugin(ScrollTrigger, SplitText)
   - Lenis initialization with GSAP ticker sync (per RESEARCH.md Pattern 5)
   - `smoothTouch: false` for iOS compatibility
   - Comment blocks for future animation modules

AVOID: Using scroll event listeners directly. Use ScrollTrigger's built-in throttling instead.
  </action>
  <verify>Open browser DevTools console, check no errors. Type `gsap` and `lenis` in console - both should be defined.</verify>
  <done>GSAP, ScrollTrigger, SplitText, and Lenis loaded without errors. Lenis smooth scroll is active.</done>
</task>

<task type="auto">
  <name>Task 2: Implement sticky header scroll transform</name>
  <files>assets/js/main.js, assets/css/main.scss</files>
  <action>
1. In `assets/css/main.scss`, update `.site-header` styles:
   - Add CSS custom properties for animatable values:
     - `--header-height: 80px` (initial)
     - `--header-bg: transparent` (initial)
     - `--header-logo-color: #000` (initial for contrast on hero)
   - Use these variables in the header styles
   - Add transition for smooth fallback (0.3s ease)
   - Add `[data-scroll-state="scrolled"]` variant with:
     - Smaller height (60px)
     - Solid dark background (rgba(10,10,10,0.98))
     - White text for contrast

2. In `assets/js/main.js`, add header scroll behavior:
   - Use ScrollTrigger to detect scroll position
   - When scrolled past 100px, add `data-scroll-state="scrolled"` attribute
   - When back at top, set to `data-scroll-state="top"`
   - Use toggleActions or callback, NOT scrub (discrete state change)

AVOID: Animating height/padding directly with GSAP (causes reflow). Instead, use CSS variables or data attributes with CSS transitions.
AVOID: Creating ScrollTriggers out of DOM order.
  </action>
  <verify>Scroll down the page - header should shrink and get dark background. Scroll back to top - header should return to transparent/larger state. No jank or stuttering.</verify>
  <done>Header smoothly transitions between "top" (large, transparent) and "scrolled" (compact, dark) states based on scroll position.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Page loads without console errors
- [ ] `gsap`, `ScrollTrigger`, `SplitText`, `lenis` all defined in console
- [ ] Smooth scroll feels polished (not CSS native choppy)
- [ ] Header transforms on scroll (shrink + background)
- [ ] Header returns to original state when scrolled to top
- [ ] No visual jank during scroll
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Animation infrastructure ready for text reveals (Plan 02)
- Header scroll behavior matches design intent
</success_criteria>

<output>
After completion, create `.planning/phases/03-scroll-experience/03-01-SUMMARY.md`
</output>
